/*!
 * TutorJS - smart tutorials for site users
 * @version  v1.3
 * @author   Gerrproger
 * http://datatables.net/license_gpl2
 * Copyright 2014 Gerrproger <gerrproger@gmail.com>
 * https://github.com/Gerrproger/TutorJS
 */
!function(){"use strict";window.tutorJS={VERSION:1.3,canva:null,hole:null,bg:null,hint:null,text:null,wrap:null,bNext:null,bQuit:null,tNext:null,tQuit:null,aNext:null,aQuit:null,tCount:null,nAll:null,nCurr:null,inited:!1,active:null,elements:null,nodes:[],html:null,scrolling:!1,activeEl:null,defOptions:{showQuit:!0,showNext:!0,showCount:!0,showHint:!0,bgQuit:!0,onQuit:null,auto:null,time:300},options:null,butW:80,butH:34,pad:10,shif:10,lineL:30,lineH:20,ID:function(t){return document.getElementById(t)},EL:function(t){return document.querySelector(t)},ELS:function(t){return document.querySelectorAll(t)},extend:function(t,n){var e,o={};for(e in t)o[e]=t[e];for(e in n)o[e]=n[e];return o},anim:function(t,n,e){var o=this,i=o.create("animate"),u={};return o.attr(i,{attributeName:n.attr,to:n.to,dur:n.dur/1e3+"s",fill:"freeze",keySplines:"0.42 0 0.58 1",calcMode:"spline"}),t.appendChild(i),i.beginElement&&i.beginElement(),u[n.attr]=n.to,setTimeout(function(){o.attr(t,u),t.removeChild(i),"function"==typeof e&&e(t)},n.dur),{and:function(n,e){return o.anim(t,n,e)},anim:function(t,n,e){return o.anim(t,n,e)}}},attr:function(t,n){for(var e in n)t.setAttributeNS(null,e,n[e]);return this},on:function(t,n,e){var o=this;return t.addEventListener(n,function(n){e(n,t,o)},!1),{on:function(n,e){return o.on(t,n,e)}}},create:function(t,n){return n?document.createTextNode(t):document.createElementNS("http://www.w3.org/2000/svg",t)},offset:function(t){return t.getBoundingClientRect()},width:function(t){return t.offsetWidth},height:function(t){return t.offsetHeight},positionTop:function(t){for(var n=0;t;)n+=parseFloat(t.offsetTop),t=t.offsetParent;return n},easeInOutQuad:function(t,n,e,o){return t/=o/2,1>t?e/2*t*t+n:(t--,-e/2*(t*(t-2)-1)+n)},requestAnimFrame:window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)},scrolledTop:function(){return document.documentElement.scrollTop||document.body.scrollTop||0},animateScroll:function(t,n){var e=this,o=e.scrolledTop(),i=t-o,u=0,r=20;e.scrolling=!0;var a=function(){u+=r,window.scrollTo(0,e.easeInOutQuad(u,o,i,e.options.time)),u<e.options.time?e.requestAnimFrame.call(window,a):(e.scrolling=!1,"function"==typeof n&&n())};a()},isInView:function(t){var n=this,e=t.top?t.top:n.positionTop(t),o=t.height?t.top+t.height:e+n.height(t),i=n.scrolledTop(),u=i+document.documentElement.clientHeight;return u>=o&&e>=i},go:function(t){var n,e,o,i,u=this,r=u.activeEl.element;if(void 0!==r.width&&void 0!==r.height&&void 0!==r.top&&void 0!==r.left)n=r.left,e=r.top-u.scrolledTop(),o=r.width,i=r.height;else{if(!(r instanceof HTMLElement))throw new Error("No such element on this page! ["+(u.active+1)+"]("+u.elements[u.active].element+")");var a=u.offset(r);n=a.left,e=a.top,o=u.width(r),i=u.height(r)}if(!(o||i||n||e))throw new Error("This element is hidden! ["+(u.active+1)+"]("+u.elements[u.active].element+")");return t?u.attr(u.hole,{width:o,height:i,x:n,y:e}):u.anim(u.hole,{attr:"width",to:o,dur:u.options.time}).and({attr:"height",to:i,dur:u.options.time}).and({attr:"x",to:n,dur:u.options.time}).and({attr:"y",to:e,dur:u.options.time}),{l:n,t:e,w:o,h:i}},texter:function(t){var n=this,e=n.activeEl.caption,o=Math.round(n.options.time/3),i=1,u=!1,r=[],a=0,l=null,s=null;if(e){for(l=0,s=e.length;s>l;l++)l+1>n.lineL*i&&(u=!0,i++),u&&" "==e[l]&&(r.push(e.substring(a,l+1)),a=l+1,u=!1);r.length?a<e.length&&r.push(e.substring(a,e.length)):r.push(e)}return n.nodes.length&&n.anim(n.hint,{attr:"opacity",to:0,dur:o},function(){for(var t=0,e=n.nodes.length;e>t;t++)n.text.removeChild(n.nodes[t]);n.nodes.length=0}),setTimeout(function(){for(n.options.showCount&&(n.nCurr&&n.tCount.removeChild(n.nCurr),n.nCurr=n.create(n.active,!0),n.tCount.insertBefore(n.nCurr,n.nAll)),l=0,s=r.length;s>l;l++){var e=n.create("tspan"),o=n.create(r[l],!0);n.attr(e,{x:0}),0==l?n.attr(e,{dy:n.pad}):n.attr(e,{dy:n.lineH}),e.appendChild(o),n.text.appendChild(e),n.nodes.push(e)}n.hintPos(t)},n.options.time),n},hintPos:function(t,n){var e=this,o=e.activeEl.position;if(e.options.showHint&&(e.activeEl.caption||e.options.showNext||e.options.showQuit||e.options.showCount)){var i=e.text.getBBox(),u=null,r=null,a=null,l=null,s=null,c=null;e.options.showNext&&(s={el1:e.bNext,el2:e.tNext,offs:e.tNext.getBBox()}),e.options.showQuit&&e.options.showNext?a={el1:e.bQuit,el2:e.tQuit,offs:e.tQuit.getBBox()}:e.options.showQuit&&(s={el1:e.bQuit,el2:e.tQuit,offs:e.tQuit.getBBox()}),e.options.showCount&&(l=c={el1:e.tCount,offs:e.tCount.getBBox()});var h=(e.options.showNext?e.butW:0)+(e.options.showQuit?e.butW:0)+(e.options.showCount?c.offs.width:0)+2*e.pad,p=e.options.showNext||e.options.showQuit||e.options.showCount?e.butH:0;if(i.width<h){var d={width:h,height:i.height,x:i.x,y:i.y};i=d}switch(o){case"top":u=t.l+e.pad,r=t.t-i.height-e.shif-e.pad-p;break;case"left":u=t.l-i.width-e.shif-e.pad,r=t.t+e.pad;break;case"right":u=t.l+t.w+e.shif+e.pad,r=t.t+e.pad;break;default:u=t.l+e.pad,r=t.t+t.h+e.shif+e.pad}for(var f=0,m=e.nodes.length;m>f;f++)e.attr(e.nodes[f],{x:u});if(e.attr(e.text,{x:u,y:r}).attr(e.wrap,{x:u-e.pad,y:r-e.pad,height:i.height+2*e.pad+(p?e.butH:0),width:i.width+2*e.pad}),s&&e.attr(s.el1,{x:u+i.width+e.pad-e.butW,y:r+i.height+e.pad}).attr(s.el2,{x:u+e.pad/2+Math.round(i.width-(e.butW+s.offs.width)/2),y:r+i.height+2*e.pad+Math.round((e.butH-1.2*s.offs.height)/2)}),a&&e.attr(a.el1,{x:u,y:r+i.height+e.pad}).attr(a.el2,{x:u-e.pad/2+Math.round((e.butW-a.offs.width)/2),y:r+i.height+2*e.pad+Math.round((e.butH-1.2*a.offs.height)/2)}),l){var v=u+Math.round((i.width-l.offs.width)/2);a&&s||!a&&!s||(v-=e.butW/2),e.attr(l.el1,{x:v,y:r+i.height+e.pad+e.butH/2})}return n||e.anim(e.hint,{attr:"opacity",to:1,dur:e.options.time}),e}},init:function(){var t=this;return t.canva=t.ID("tutorJS-svg"),t.hole=t.ID("tutorJS-hole"),t.bg=t.ID("tutorJS-bg"),t.text=t.ID("tutorJS-text"),t.wrap=t.ID("tutorJS-wrap"),t.bNext=t.ID("tutorJS-nextW"),t.bQuit=t.ID("tutorJS-quitW"),t.tNext=t.ID("tutorJS-nextT"),t.tQuit=t.ID("tutorJS-quitT"),t.aNext=t.ID("tutorJS-next"),t.aQuit=t.ID("tutorJS-quit"),t.tCount=t.ID("tutorJS-count"),t.hint=t.ID("tutorJS-hint"),t.html=t.EL("html"),t.aNext&&t.on(t.aNext,"click",function(){t.next(),t.attr(t.bNext,{fill:"url(#tutorJS-gradient3)"})}).on("mouseover",function(){t.attr(t.bNext,{fill:"url(#tutorJS-gradient5)"})}).on("mouseout",function(){t.attr(t.bNext,{fill:"url(#tutorJS-gradient3)"})}),t.aQuit&&t.on(t.aQuit,"click",function(){t.quit()}).on("mouseover",function(){t.attr(t.bQuit,{fill:"url(#tutorJS-gradient6)"})}).on("mouseout",function(){t.attr(t.bQuit,{fill:"url(#tutorJS-gradient4)"})}),t.on(t.bg,"click",function(){t.options.bgQuit&&t.quit()}),t.on(window,"resize",function(){t.recalc()}).on("scroll",function(){t.scrolling||t.recalc()}),t},starter:function(t){var n=this;return n.options.showQuit?n.aQuit.style.display="block":n.aQuit&&(n.aQuit.style.display="none"),n.options.showNext?n.aNext.style.display="block":n.aNext&&(n.aNext.style.display="none"),n.options.showCount?(t||(n.nAll=n.create("/"+n.elements.length,!0),n.tCount.appendChild(n.nAll)),n.tCount.style.display="block"):(t||(n.nAll=null),n.tCount&&(n.tCount.style.display="none")),n},next:function(t){var n=this;if("re"!=t||n.options.auto){if(!n.elements||!n.elements[n.active])return n.active>0&&n.quit(),n;t&&"re"!=t&&(n.options.auto=t),n.activeEl=n.elements[n.active];var e=n.activeEl.element,o=function(){"function"==typeof n.activeEl.onActive&&n.activeEl.onActive(n.activeEl,n.active+1),n.texter(n.go()).active++,n.options.auto&&setTimeout(function(){n.next("re")},n.options.auto)};if(!e)throw new Error('Can not find argument "element"! ['+(n.active+1)+"]");if("string"==typeof e&&(n.activeEl.element=e=n.ID(e)),n.isInView(e))o();else{var i=Math.round(n.options.time/3);n.anim(n.hole,{attr:"opacity",to:0,dur:i}).anim(n.hint,{attr:"opacity",to:0,dur:i},function(){n.attr(n.hole,{width:0,height:0,x:0,y:0,opacity:1}),n.animateScroll((e.top?e.top:n.positionTop(e))-n.pad,function(){o()})})}return n}},set:function(t,n){var e=this,o=e.activeEl;return"object"==typeof t&&(e.options=e.extend(e.options,t)),"object"==typeof n&&(e.activeEl=e.extend(e.activeEl,n)),e.anim(e.hint,{attr:"opacity",to:0,dur:Math.round(e.options.time/3)},function(){e.starter(!0);var t=e.activeEl.element,n=function(){"function"==typeof t.onActive&&t.onActive(e.activeEl,e.active),o.caption!==e.activeEl.caption?e.texter(e.go()):e.hintPos(e.go(!0)),e.options.auto&&setTimeout(function(){e.next("re")},e.options.auto)};if(o.element!==t){if(!t)throw new Error('Can not find argument "element"! ['+e.active+"]");if("string"==typeof t&&(e.activeEl.element=t=e.ID(t)),e.isInView(t))n();else{var i=Math.round(e.options.time/3);e.anim(e.hole,{attr:"opacity",to:0,dur:i}).anim(e.hint,{attr:"opacity",to:0,dur:i},function(){e.attr(e.hole,{width:0,height:0,x:0,y:0,opacity:1}),e.animateScroll((t.top?t.top:e.positionTop(t))-e.pad,function(){n()})})}}else n()}),e},stop:function(){var t=this;return t.options.auto=null,t},start:function(t,n){var e=this,o=function(){e.starter(),e.canva.style.display="block",e.anim(e.bg,{attr:"opacity",to:1,dur:3*e.options.time},function(){e.next()})};return e.active=0,e.options="object"==typeof n?e.extend(e.defOptions,n):e.defOptions,e.elements=t.length?t:[t],e.inited?(e.nAll&&(e.tCount.removeChild(e.nAll),e.nAll=null),e.anim(e.hint,{attr:"opacity",to:0,dur:Math.round(e.options.time/3)},function(){o()})):(e.init(),e.inited=!0,o()),e},quit:function(){var t=this;return t.active=null,t.stop(),t.anim(t.hole,{attr:"opacity",to:0,dur:t.options.time}).anim(t.hint,{attr:"opacity",to:0,dur:t.options.time}).anim(t.bg,{attr:"opacity",to:0,dur:3*t.options.time},function(){t.canva.style.display="none",t.attr(t.hole,{width:0,height:0,x:0,y:0,opacity:1}),"function"==typeof t.options.onQuit&&t.options.onQuit(t)}),t},recalc:function(){var t=this;return null==t.active?t:(t.hintPos(t.go(!0),!0),t)}}}();
