/*!
 * TutorJS - smart tutorials for site users
 * @version  v1.2
 * @author   Evgenii Dulikov
 * http://datatables.net/license_gpl2
 * Copyright 2014 Evgenii Dulikov <gerrproger@gmail.com>
 * https://github.com/Gerrproger/TutorJS
 */
!function(){"use strict";window.tutorJS={VERSION:1.2,canva:null,hole:null,bg:null,hint:null,text:null,wrap:null,bNext:null,bQuit:null,tNext:null,tQuit:null,tCount:null,nAll:null,nCurr:null,inited:!1,active:null,elements:null,auto:null,onQuit:null,nodes:[],htmlOv:null,bodyOv:null,html:null,scrolling:!1,activeEl:{pos:null,el:null},butW:80,butH:34,t:300,pad:10,shif:10,lineL:30,lineH:20,ID:function(t){return document.getElementById(t)},EL:function(t){return document.querySelector(t)},ELS:function(t){return document.querySelectorAll(t)},anim:function(t,e,n){var o=this,i=o.create("animate"),r={};return o.attr(i,{attributeName:e.attr,to:e.to,dur:e.dur/1e3+"s",fill:"freeze",keySplines:"0.42 0 0.58 1",calcMode:"spline"}),t.appendChild(i),i.beginElement&&i.beginElement(),r[e.attr]=e.to,setTimeout(function(){o.attr(t,r),t.removeChild(i),"function"==typeof n&&n(t)},e.dur),{and:function(e,n){return o.anim(t,e,n)},anim:function(t,e,n){return o.anim(t,e,n)}}},attr:function(t,e){for(var n in e)t.setAttributeNS(null,n,e[n]);return this},on:function(t,e,n){var o=this;return t.addEventListener(e,function(e){n(e,t,o)},!1),{on:function(e,n){return o.on(t,e,n)}}},create:function(t,e){return e?document.createTextNode(t):document.createElementNS("http://www.w3.org/2000/svg",t)},offset:function(t){return t.getBoundingClientRect()},width:function(t){return t.offsetWidth},height:function(t){return t.offsetHeight},positionTop:function(t){for(var e=0;t;)e+=parseFloat(t.offsetTop),t=t.offsetParent;return e},scrolledTop:function(){return document.documentElement.scrollTop||document.body.scrollTop||0},isInView:function(t){var e=this,n=e.positionTop(t),o=n+e.height(t),i=e.scrolledTop(),r=i+document.documentElement.clientHeight;return r>=o&&n>=i},go:function(t,e){var n=this,o=n.offset(t),i=n.width(t),r=n.height(t);if(!(i||r||o.left||o.top))throw new Error("This element is hidden! ["+(n.active+1)+"]("+n.elements[n.active].element+")");return e?n.attr(n.hole,{width:i,height:r,x:o.left,y:o.top}):n.anim(n.hole,{attr:"width",to:i,dur:n.t}).and({attr:"height",to:r,dur:n.t}).and({attr:"x",to:o.left,dur:n.t}).and({attr:"y",to:o.top,dur:n.t}),o.w=i,o.h=r,o},texter:function(t,e,n){var o=this,i=Math.round(o.t/3),r=1,u=!1,l=[],a=0,h=null,c=null;for(h=0,c=t.length;c>h;h++)h+1>o.lineL*r&&(u=!0,r++),u&&" "==t[h]&&(l.push(t.substring(a,h+1)),a=h+1,u=!1);return l.length?a<t.length&&l.push(t.substring(a,t.length)):l.push(t),o.nodes.length&&o.anim(o.hint,{attr:"opacity",to:0,dur:i},function(){for(var t=0,e=o.nodes.length;e>t;t++)o.text.removeChild(o.nodes[t]);o.nodes.length=0}),setTimeout(function(){for(o.nCurr&&o.tCount.removeChild(o.nCurr),o.nCurr=o.create(o.active,!0),o.tCount.insertBefore(o.nCurr,o.nAll),h=0,c=l.length;c>h;h++){var t=o.create("tspan"),i=o.create(l[h],!0);o.attr(t,{x:0}),0==h?o.attr(t,{dy:o.pad}):o.attr(t,{dy:o.lineH}),t.appendChild(i),o.text.appendChild(t),o.nodes.push(t)}o.hintPos(e,n)},o.t),o},hintPos:function(t,e,n){var o=this,i=o.text.getBBox(),r=o.tCount.getBBox(),u=o.tNext.getBBox(),l=o.tQuit.getBBox(),a=2*o.butW+r.width+2*o.pad,h=null,c=null;if(i.width<a){var d={width:a,height:i.height,x:i.x,y:i.y};i=d}switch(e){case"top":h=t.left+o.pad,c=t.top-i.height-o.shif-o.pad-o.butH;break;case"left":h=t.left-i.width-o.shif-o.pad,c=t.top+o.pad;break;case"right":h=t.left+t.w+o.shif+o.pad,c=t.top+o.pad;break;default:h=t.left+o.pad,c=t.top+t.h+o.shif+o.pad}for(var s=0,f=o.nodes.length;f>s;s++)o.attr(o.nodes[s],{x:h});o.attr(o.text,{x:h,y:c}).attr(o.wrap,{x:h-o.pad,y:c-o.pad,height:i.height+2*o.pad+o.butH,width:i.width+2*o.pad}).attr(o.bNext,{x:h+i.width+o.pad-o.butW,y:c+i.height+o.pad}).attr(o.tNext,{x:h+o.pad/2+Math.round(i.width-(o.butW+u.width)/2),y:c+i.height+2*o.pad+Math.round((o.butH-1.2*u.height)/2)}).attr(o.bQuit,{x:h,y:c+i.height+o.pad}).attr(o.tQuit,{x:h-o.pad/2+Math.round((o.butW-l.width)/2),y:c+i.height+2*o.pad+Math.round((o.butH-1.2*l.height)/2)}).attr(o.tCount,{x:h+Math.round((i.width-r.width)/2),y:c+i.height+o.pad+o.butH/2}),n||o.anim(o.hint,{attr:"opacity",to:1,dur:o.t})},init:function(){var t=this;t.canva=t.ID("tutorJS-svg"),t.hole=t.ID("tutorJS-hole"),t.bg=t.ID("tutorJS-bg"),t.text=t.ID("tutorJS-text"),t.wrap=t.ID("tutorJS-wrap"),t.bNext=t.ID("tutorJS-nextW"),t.bQuit=t.ID("tutorJS-quitW"),t.tNext=t.ID("tutorJS-nextT"),t.tQuit=t.ID("tutorJS-quitT"),t.tCount=t.ID("tutorJS-count"),t.hint=t.ID("tutorJS-hint"),t.html=t.EL("html"),t.htmlOv=t.html.style.overflow,t.bodyOv=document.body.style.overflow,t.on(t.ID("tutorJS-next"),"click",function(){t.next(),t.attr(t.bNext,{fill:"url(#tutorJS-gradient3)"})}).on("mouseover",function(){t.attr(t.bNext,{fill:"url(#tutorJS-gradient5)"})}).on("mouseout",function(){t.attr(t.bNext,{fill:"url(#tutorJS-gradient3)"})}),t.on(t.ID("tutorJS-quit"),"click",function(){t.quit()}).on("mouseover",function(){t.attr(t.bQuit,{fill:"url(#tutorJS-gradient6)"})}).on("mouseout",function(){t.attr(t.bQuit,{fill:"url(#tutorJS-gradient4)"})}),t.on(window,"resize",function(){t.recalc()}).on("scroll",function(){t.scrolling||t.recalc()})},next:function(t){var e=this;if("re"!=t||e.auto){if(!e.elements||!e.elements[e.active])return e.active>0&&e.quit(),e;t&&"re"!=t&&(e.auto=t);var n=e.elements[e.active].element,o=e.elements[e.active].position;if("string"==typeof n&&(n=e.ID(n)),!(n instanceof HTMLElement))throw new Error("No such element on this page! ["+(e.active+1)+"]("+e.elements[e.active].element+")");e.isInView(n)||(e.scrolling=!0,window.scrollTo(0,e.positionTop(n)-e.pad),setTimeout(function(){e.scrolling=!1},50)),"function"==typeof e.elements[e.active].onActive&&e.elements[e.active].onActive(n,e.active+1);var i=e.go(n);return e.texter(e.elements[e.active].caption,i,o).active++,e.activeEl.el=n,e.activeEl.pos=o,e.auto&&setTimeout(function(){e.next("re")},e.auto),e}},stop:function(){var t=this;return t.auto=null,t},start:function(t,e){var n=this;return n.active=0,"object"==typeof e&&(n.auto=e.auto,n.onQuit=e.onQuit),n.elements=t.length?t:[t],n.inited?n.nAll&&(n.tCount.removeChild(n.nAll),n.nAll=null):(n.init(),n.inited=!0),n.html.style.overflow=document.body.overflow="hidden",n.nAll=n.create("/"+n.elements.length,!0),n.tCount.appendChild(n.nAll),n.canva.style.display="block",n.anim(n.bg,{attr:"opacity",to:1,dur:3*n.t},function(){n.next()}),n},quit:function(){var t=this;return t.active=null,t.stop(),t.anim(t.hole,{attr:"opacity",to:0,dur:t.t}).anim(t.hint,{attr:"opacity",to:0,dur:t.t}).anim(t.bg,{attr:"opacity",to:0,dur:3*t.t},function(){t.html.style.overflow=t.htmlOv,document.body.style.overflow=t.bodyOv,t.canva.style.display="none",t.attr(t.hole,{width:0,height:0,x:0,y:0,opacity:1}),"function"==typeof t.onQuit&&t.onQuit(t)}),t},recalc:function(){var t=this;return null==t.active?t:(t.hintPos(t.go(t.activeEl.el,!0),t.activeEl.pos,!0),t)}}}();